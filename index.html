<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>洛克人 – 真正的經典版</title>
  <style>
    body{margin:0;background:#000;overflow:hidden;}
    canvas{display:block;border:8px solid #00ffff;box-shadow:0 0 50px #00ffff;background:#001122;}
    #ui{position:absolute;top:10px;left:10px;color:#fff;font-family:Arial;z-index:10;}
    #info{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);color:#0ff;font-size:14px;}
  </style>
</head>
<body>
<div id="ui">生命: <span id="lives">3</span>　分數: <span id="score">0</span>　武器: <span id="weapon">普通</span></div>
<canvas id="c" width="800" height="450"></canvas>
<div id="info">A/D移動　W跳　長按J蓄力射擊（面向方向）　撿武器換形態</div>

<script>
// 真正的洛克人開始！
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
const cam = {x:0, y:0};
const G = 0.8, JUMP = -16, SPEED = 5;

let player = {x:100,y:300,w:40,h:60,vx:0,vy:0,onGround:false,facing:1,charge:0,form:'normal'};
let bullets=[], enemies=[], items=[], platforms=[], particles=[];
let score=0, lives=3;

// 經典平台
platforms = [
  {x:0,y:400,w:2000,h:50}, // 地面
  {x:300,y:350,w:150,h:20},
  {x:600,y:300,w:200,h:20},
  {x:900,y:250,w:150,h:20},
  {x:1200,y:320,w:180,h:20},
  {x:1500,y:280,w:200,h:20},
  {x:1850,y:350,w:150,h:20}
];

// 武器道具
items.push({x:500,y:250,type:'fire'});
items.push({x:1000,y:200,type:'electric'});
items.push({x:1600,y:220,type:'ice'});

// 生成小怪
setInterval(()=>{
  if(Math.random()<0.7) enemies.push({x:canvas.width+50,y:340,hp:3,type:'normal'});
}, 2000);

const weapons = {
  normal: {color:'#00ffff', name:'普通', shot:normalShot},
  fire:   {color:'#ff4400', name:'火焰', shot:fireShot},
  electric:{color:'#00ff88', name:'電擊', shot:electricShot},
  ice:    {color:'#44ffff', name:'冰凍', shot:iceShot}
};

function normalShot(){ shoot(15, 20, '#00ffff'); }
function fireShot(){ for(let i=-1;i<=1;i++) shoot(18, 25, '#ff8800', i*2); }
function electricShot(){ shoot(12, 40, '#aaff00', 0, true); }
function iceShot(){ shoot(10, 30, '#88ffff', 0, false, true); }

function shoot(speed,size,color,vy=0,shock=false,freeze=false){
  const power = player.charge>100?2:1;
  bullets.push({
    x:player.x+(player.facing>0?player.w:0),
    y:player.y+30,
    vx:player.facing*speed*power,
    vy,
    size:size*power,
    color,
    shock,
    freeze
  });
  player.charge=0;
}

// 主循環
function update(){
  // 移動
  player.vx=0;
  if(keys['a']){player.vx=-SPEED;player.facing=-1;}
  if(keys['d']){player.vx=SPEED;player.facing=1;}
  if(keys['w']&&player.onGround) player.vy=JUMP;

  // 蓄力
  if(keys['j']) player.charge=Math.min(player.charge+15,300);
  else if(player.charge>30) weapons[player.form].shot();

  player.vy+=G; player.x+=player.vx; player.y+=player.vy;

  // 平台碰撞
  player.onGround=false;
  platforms.forEach(p=>{
    if(collide(player,p)){
      if(player.vy>0){
        player.y=p.y-player.h;
        player.vy=0;
        player.onGround=true;
      }
    }
  });

  // 相機跟隨（真正的橫版捲軸！）
  cam.x = player.x - canvas.width/3;

  // 撿武器變身
  items = items.filter(item=>{
    if(collide(player,item)){
      player.form = item.type;
      document.getElementById('weapon').textContent = weapons[item.type].name;
      createParticles(item.x+20, item.y+20, weapons[item.type].color, 30);
      return false;
    }
    return true;
  });

  // 更新子彈、敵人、碰撞、得分
  bullets.forEach((b,i)=>{
    b.x+=b.vx; b.y+=b.vy;
    if(b.x<-100||b.x>canvas.width+100) bullets.splice(i,1);
  });
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save();
  ctx.translate(-cam.x,0);

  // 背景星星
  ctx.fillStyle='#fff';
  for(let i=0;i<200;i++){
    const x = (i*123 + Date.now()/20)%3000;
    ctx.globalAlpha = 0.3 + Math.sin(Date.now()/1000)*0.3;
    ctx.fillRect(x, i*20%400, 2, 2);
  }
  ctx.globalAlpha=1;

  // 平台（發光）
  platforms.forEach(p=>{
    ctx.fillStyle='#0088ff';
    ctx.shadowColor='#00ffff'; ctx.shadowBlur=30;
    ctx.fillRect(p.x,p.y,p.w,p.h);
  });
  ctx.shadowBlur=0;

  // 玩家（根據武器變色）
  ctx.fillStyle = weapons[player.form].color;
  ctx.shadowColor = weapons[player.form].color;
  ctx.shadowBlur = 40;
  ctx.fillRect(player.x+5,player.y+5,player.w-10,player.h-10);

  // 蓄力條
  if(player.charge>30){
    ctx.fillStyle='rgba(255,255,255,0.9)';
    ctx.fillRect(player.x,player.y-15,(player.charge/300)*player.w,8);
  }
  ctx.shadowBlur=0;

  // 子彈
  bullets.forEach(b=>{
    ctx.shadowColor=b.color; ctx.shadowBlur=25;
    ctx.fillStyle=b.color;
    ctx.fillRect(b.x,b.y,b.size,b.size);
  });
  ctx.shadowBlur=0;

  // 敵人
  enemies.forEach(e=>{
    ctx.fillStyle='#ff0066';
    ctx.fillRect(e.x,e.y,40,50);
  });

  // 武器道具（旋轉發光）
  items.forEach(item=>{
    ctx.save();
    ctx.translate(item.x+20,item.y+20);
    ctx.rotate(Date.now()/300);
    ctx.shadowColor=weapons[item.type].color;
    ctx.shadowBlur=50;
    ctx.fillStyle=weapons[item.type].color;
    ctx.fillRect(-20,-20,40,40);
    ctx.restore();
  });

  ctx.restore();
}

function collide(a,b){
  return a.x<a.x+b.w&&a.x+a.w>b.x&&a.y<b.y+b.h&&a.y+a.h>b.y;
}

function createParticles(x,y,color,count=20){
  for(let i=0;i<count;i++){
    particles.push({x,y,vx:(Math.random()-0.5)*10,vy:(Math.random()-0.5)*10,life:30,color});
  }
}

// 鍵盤
const keys={};
document.addEventListener('keydown',e=>keys[e.key.toLowerCase()]=true);
document.addEventListener('keyup',e=>keys[e.key.toLowerCase()]=false);

function loop(){
  update(); draw(); requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
